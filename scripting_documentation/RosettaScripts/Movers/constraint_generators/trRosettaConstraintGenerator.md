# trRosettaConstraintGenerator
*Back to [[Mover|Movers-RosettaScripts]] page.*

Documentation added 25 Mar 2021 by Vikram K. Mulligan, Flatiron Institute (vmulligan@flatironinstitute.org).

## trRosettaConstraintGenerator

The trRosettaConstraintGenerator takes as input a multiple sequence alignment, converts this to a one-hot 3D input tensor, and runs this through the trRosetta neural network to generate predictions of the probability distributions of inter-residue distances and orientations.  It then converts this information to a list of Rosetta constraints.

These constraints can be useful for _de novo_ structure prediction.  In this case, however, it is not necessary to script this constraint generator directly.  Instead, the [[trRosetta application|trRosetta]] and the [[trRosettaProtocol mover|trRosettaProtocol]] wrap this constraint generator, and provide a full structure prediction pipeline that takes an MSA as input and produces a pose as output.  If one wishes to do more exotic things, such as using trRosetta distance and orientation constraints in design, docking, or loop modelling, it can be useful to have direct access to the trRosettaConstraintGenerator, however.

### A note on nomenclature

Although "omega" and "phi" are commonly used to refer to the third and first mainchain backbone dihedrals of an alpha amino acid, and "theta" is used to refer to the second mainchain backbone dihedral of a beta-amino acid, in the context of trRosetta-related protocols, these Greek letters are assigned new meanings.  Here, "omega" refers to the inter-residue dihedral angle between the CA and CB atoms of a first residue and the CB and CA atoms of a second residue.  "Theta" refers to the inter-residue dihedral angle between the N, CA, and CB atoms of a first residue and the CB atom of a second residue.  And "phi" refers to the inter-residue angle between the CA and CB atoms of a first residue and the CB atom of a second residue.

### Compilation requirements

The trRosettaConstraintGenerator requires that Rosetta be compiled with Tensorflow support.  See the autogenerated description below for details on how to compile Rosetta and link Tensorflow.

## All options

[[include:constraint_generator_trRosettaConstraintGenerator_type]]

### Best practices

At the time of this writing, it is recommended to leave all options set to defaults unless one has reason to customize the settings.

## Example

The following example roughly reproduces the protocol used by the [[trRosettaProtocol mover|trRosettaProtocol]] and [[trRosetta application|trRosetta]].  **Note that (a) this is somewhat simplified, limiting its accuracy as a structure prediction protocol, and (b) it is not necessary to manually script the full structure prediction protocol, since the mover or the application can be used instead.  This is only for demonstration purposes to show how the trRosettaConstraintGenerator can be scripted.**

```xml
<ROSETTASCRIPTS>
	<SCOREFXNS>
		<ScoreFunction name="cen" weights="score0.wts" >
			<Reweight scoretype="atom_pair_constraint" weight="5.0" />
			<Reweight scoretype="angle_constraint" weight="1.0" />
			<Reweight scoretype="dihedral_constraint" weight="1.0" />
		</ScoreFunction>
		<ScoreFunction name="r15" weights="ref2015.wts" />
		<ScoreFunction name="r15_cst" weights="ref2015_cst.wts" />
	</SCOREFXNS>
	<SIMPLE_METRICS>
		<RMSDMetric name="measure_rmsd"
			use_native="true"
			super="true"
			custom_type="RMSD_after_centroid_phase_"
			rmsd_type="rmsd_protein_bb_heavy"
		/>
		<RMSDMetric name="measure_rmsd2"
			use_native="true"
			super="true"
			custom_type="RMSD_after_fullatom_phase_"
			rmsd_type="rmsd_protein_bb_heavy"
		/>

	</SIMPLE_METRICS>
	<CONSTRAINT_GENERATORS>
		<trRosettaConstraintGenerator name="gen_csts"
			msa_file="inputs/1r6j_msa.a3m"
		/> 
	</CONSTRAINT_GENERATORS>
	<MOVERS>
		<InitializeByBins name="randomize_bb"
			bin_params_file="ABBA"
		/>
		<AddConstraints name="gen_csts_mover"
			constraint_generators="gen_csts"
		/>
		<MinMover name="minimize"
			scorefxn="cen"
			tolerance="0.0000001"
			bb="true" chi="false" jump="0"
		/>
		<ClearConstraintsMover name="remove_csts" />
		<SwitchResidueTypeSetMover name="make_fullatom" set="fa_standard"/>
		<FastRelax name="frlx" repeats="3" scorefxn="r15_cst" />
	</MOVERS>
	<PROTOCOLS>
		<Add mover="randomize_bb" />
		<Add mover="gen_csts_mover" />
		<Add mover="minimize" />
		<Add metrics="measure_rmsd" />
		<Add mover="remove_csts" />
		<Add mover="make_fullatom" />
		<Add mover="gen_csts_mover" />
		<Add mover="frlx" />
		<Add metrics="measure_rmsd2" />
	</PROTOCOLS>
	<OUTPUT scorefxn="r15" />
```

The input multiple sequence alignment file can be generated with HHBlits or other software.  See the [[trRosettaProtocol mover|trRosettaProtocol]] documentation for more details and an example of the .a3m file format.

## Code organization

Please see the [[trRosetta application|trRosetta]] documentation for information about the trRosetta code organization.

## References

- The trRosetta neural network is described in Yang _et al_. (2020) _Proc Natl Acad Sci USA_ 117(3):1496-1503 (doi 10.1073/pnas.1914677117).
- The [[trRosettaProtocol]] mover, trRosettaConstriantGenerator, [[trRosetta application|trRosetta]], and other C++ infrastructure were written by Vikram K. Mulligan (vmulligan@flatironinstitute.org), and are currently unpublished.

## See Also

* [[trRosettaProtocol mover|trRosettaProtocol]]:  A mover that uses this constraint generator and the [[MinMover]] to predict protein structure.
* [[trRosetta application|trRosetta]]: Essentially, the above mover in application form, so that you can provide an MSA on the commandline and get a structure out.
* [[MinMover]]: Used by the [[trRosettaProtocol]] mover to find conformations compatible with the trRosetta constraints.
* [[FastRelax]]:  Used by the [[trRosettaProtocol]] mover for all-atom refinement.
* [[AbinitioRelax application|abinitio-relax]]:  Classic, fragment-based structure prediction.