# PNear Ensemble Metric
*Back to [[EnsembleMetrics]] page.*
## PNear Ensemble Metric

[[_TOC_]]

### Description

P<sub>Near</sub> is a metric used to describe the propensity of a sequence to favour a particular conformational state.  It was first described in Bhardwaj, Mulligan, Bahl _et al_. (2016) _Nature_ 538(7625):329-335, doi: 10.1038/nature19791.  The PNear [[EnsembleMetric|EnsembleMetrics]] computes P<sub>Near</sub> given a conformational ensemble generated by some protocol.  It can optionally compute the propensity to favour some desired state, provided with the `-in:file:native` commandline option or with the `native_file` option in RosettaScripts, or it can compute the propensity to favour the lowest-energy state observed in the ensemble.

### Author and history

Created Thursday, 10 March 2022 by Vikram K. Mulligan, Center for Computational Biology, Flatiron Institute (vmulligan@flatironinstitute.org).

### Details of the calculation

P<sub>Near</sub> is defined as follows:

![Expression defining PNear](/scripting_documentation/RosettaScripts/EnsembleMetrics/ensemble_metric_pages/PNear_Eqn.png)

In the above, _N_ is the number of structures in the ensemble, _E<sub>i</sub>_ and _rmsd<sub>i</sub>_ are the energy and the RMSD to target conformation of the ith sample, respectively, and λ (lambda) and k<sub>B</sub>T are two parameters controlling the calculation of P<sub>Near</sub>.  The parameter λ, measured in Angstroms, defines how close a structure has to be to the target conformation (either the user-provided native state or the lowest-energy state in the ensemble) in order for it to be considered "close enough" to count as contributing to high propensity to favour the target state.  The parameter k<sub>B</sub>T, meaured in kcal/mol, is a Boltzmann temperature that determines how much each sampled conformation contributes to distribution of states as its energy rises.

The value of P<sub>Near</sub> ranges from 0 to 1, with values close to 0 indicating that the molecule has very low propensity to favour the desired conformation and values close to 1 indicating that it has very high propensity to do so.  It may be thought of as the Boltzmann probability of being near to the desired conformation, where "near" is defined fuzzily by a Gaussian function of RMSD with breadth λ.  By defining this fuzzily rather than sharply, numerical instability on repeated sampling runs is avoided: small changes in the distribution of samples result in _small_ changes in P<sub>Near</sub>, but could result in _large_ changes in the values of earlier metrics that used hard cutoffs to determine whether a sampled state was "native-like" or not.

### Interface

[[include:ensemble_metric_PNear_type]]

### Vector-valued metrics produced

The PNear ensemble metric produces two vectors of outputs that can be accessed from C++ or Python by calling the `PNearEnsembleMetric::get_realvector_metric_value_by_name( std::string const & name, core::Size const index )` method.  These are called "pnear_to_native" and "pnear_to_lowestE".  There is one entry in the vector for every scoring function provided when configuring the PNear ensemble metric.  (For ordinary use, when only one scoring function is provided, these are 1-vectors.)

### Example usage

The following script reads a series of PDB files or structures from a silent file (passed in with one of the `-in:file:s`, `-in:file:l` or `-in:file:silent` options), aligns each to a native structure (`inputs/native.pdb`), scores each with Rosetta's `ref2015` scoring function, and computes P<sub>Near</sub> to both the native structure and to the lowest-energy structure in the ensemble of input structuers.


```xml
<ROSETTASCRIPTS>
	<SCOREFXNS>
		<ScoreFunction name="r15" weights="ref2015.wts" />
	</SCOREFXNS>
	<MOVERS>
		<DeclareBond name="cyclize" atom1="C" atom2="N" res1="7" res2="1" />
	</MOVERS>
	<ENSEMBLE_METRICS>
		<PNear name="pnear" scorefxns="r15" use_CB_in_rmsd="false"
			compute_pnear_to_lowestE="true" compute_pnear_to_native="true"
			output_filename="pnear_analysis.txt" output_mode="tracer_and_file"
			native_file="inputs/native.pdb" native_preparation_protocol="cyclize"
			superimpose_for_rmsd="true" lambda="0.5" kbt="1.0"
		/>
	</ENSEMBLE_METRICS>
	<PROTOCOLS>
		<Add ensemble_metrics="pnear" />
	</PROTOCOLS>
</ROSETTASCRIPTS>
```

##See Also

* [[EnsembleMetrics]]: Available EnsembleMetrics.
* [[SimpleMetrics]]: Available SimpleMetrics.
* [[CentralTendency ensemble metric|CentralTendency]]: An ensemble metric that computs mean, median, mode, etc. of values produced by a [[SimpleMetric|SimpleMetrics]].
* [[I want to do x]]: Guide to choosing a tool in Rosetta.